<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset=utf-8>
  <style>
    body {
      background-position: center center;
      background-repeat: repeat-x repeat-y;
      color: white;
      font-family: Futura, sans;
    }
    div {
      margin: 3em;
    }
    span {
      background-color: rgba(0,0,0,0.5);
      border-radius: 1em;
      padding: 1em;
    }
    #image {
      display: none;
    }
    input[type=range][orient=vertical] {
      writing-mode: bt-lr; /* IE */
      -webkit-appearance: slider-vertical; /* WebKit */
    }
  </style>
  <script>
    function rescale() {
      var width = document.getElementById('image').width;
      var slider = document.getElementById('slider');
      var val = slider.value;
      var scale = 1/(16 - val);
      var denominator = (4*(16 - val));
      var numerator = 4;

      while (denominator % 2 == 0 && numerator % 2 == 0) {
        denominator /= 2;
        numerator /= 2;
      }
      document.body.style.backgroundSize = width * scale + 'px';
      document.getElementById('percentage').innerText = (100 * scale).toFixed(3).replace(/0+$/, '').replace(/\.$/, '');
      document.getElementById('numerator').innerText = numerator;
      document.getElementById('denominator').innerText = denominator;
    }

    function setImage(imageURL) {
      document.getElementById('slider').value = 15;
      rescale();
      document.body.style.backgroundSize = 'auto';
      document.body.style.backgroundImage = 'url(' + imageURL + ')';
      document.getElementById('image').src = imageURL;
    }

    function handleDrop(evt) {
      evt.stopPropagation();
      evt.preventDefault();

      if (evt.dataTransfer.files && evt.dataTransfer.files.length) {
        for (var i = 0, f; f = evt.dataTransfer.files[i]; i++) {
          if (f.type.match(/image.*/)) {
            var reader = new FileReader();
            reader.onload = function(e) {
              document.location.hash = '';
              setImage(e.target.result);
            };
            reader.readAsDataURL(f);
            break;
          }
        }
      }
      if (evt.dataTransfer.types && evt.dataTransfer.types.length) {
        for (var i = 0, t; t = evt.dataTransfer.types[i]; i++) {
          if (t == 'text/uri-list') {
            document.location.hash = encodeURIComponent(evt.dataTransfer.getData('URL'));
            break;
          }
        }
      }
    }

    function handleDrag(evt) {
      evt.stopPropagation();
      evt.preventDefault();
      evt.dataTransfer.dropEffect = 'none';
      var successEffect = 'copy'; // Has to be copy, otherwise drop event never fires in Chrome 43

      if (evt.dataTransfer.files && evt.dataTransfer.files.length) {
        for (var i = 0, f; f = evt.dataTransfer.files[i]; i++) {
          if (f.type.match(/image.*/)) {
            evt.dataTransfer.dropEffect = successEffect;
            break;
          }
        }
      }
      if (evt.dataTransfer.types && evt.dataTransfer.types.length) {
        for (var i = 0, t; t = evt.dataTransfer.types[i]; i++) {
          if (t == 'Files' || t == 'text/uri-list') {
            evt.dataTransfer.dropEffect = successEffect;
            break;
          }
        }
      }
    }

    function onImageLoad() {
        document.getElementById('help').style.display = 'none';
        var slider = document.getElementById('slider');
        slider.disabled = false;
        slider.focus();
    }

    function onHashChange() {
      if (document.location.hash.slice(1)) {
        setImage(decodeURIComponent(document.location.hash.slice(1)));
      } else {
        document.getElementById('help').style.display = 'block';
      }
    }

    function onPageLoad() {
      var dropZone = document.getElementsByTagName('html')[0];
      dropZone.addEventListener('dragenter', handleDrag, false);
      dropZone.addEventListener('dragover' , handleDrag, false);
      dropZone.addEventListener('drop', handleDrop, false);

      document.getElementById('image').addEventListener('load', onImageLoad);
      document.getElementById('slider').addEventListener('change', rescale);

      window.addEventListener('hashchange', onHashChange, false);
      onHashChange();
    }
  </script>
</head>
<body onload="onPageLoad()">
  <center>
    <div id="help">
      <span>Drop an image or URL here to try it as a background.</span>
    </div>
    <div>
      <span>
        <input type="range" min="0" max="15" value="15" step="0.25" id="slider" orient="vertical" disabled>
      </span>
    </div>
    <div>
      <span><a id="percentage">100</a>% &bull; <sup id="numerator">1</sup>/<sub id="denominator">1</sub></span>
    </div>
    <div>
      <span>by <a href="https://twitter.com/glyphobet">@glyphobet</a></span>
    </div>
    <img id="image"/>
  </center>
</body>