<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      background-position: center center;
      background-repeat: repeat-x repeat-y;
      color: white;
      font-family: Futura, sans;
    }
    div {
      margin: 3em;
    }
    span {
      background-color: rgba(0,0,0,0.5);
      border-radius: 1em;
      padding: 1em;
    }
    #image {
      display: none;
    }
  </style>
  <script>
    function rescale() {
      var width = document.getElementById('image').width;
      var slider = document.getElementById('slider');
      var val = slider.value;
      var scale = 1/(16 - val);
      var denominator = (4*(16 - val));
      var numerator = 4;

      while (denominator % 2 == 0 && numerator % 2 == 0) {
        denominator /= 2;
        numerator /= 2;
      }
      document.body.style.backgroundSize = width * scale + 'px';
      document.getElementById('percentage').innerHTML = (100 * scale).toFixed(3).replace(/0+$/, '').replace(/\.$/, '') + '% &bull; <sup>' + numerator + '</sup>/<sub>' + denominator + '</sub>';
    }

    function handleFileSelect(evt) {
      evt.stopPropagation();
      evt.preventDefault();
      var files = evt.dataTransfer.files;

      var reader = new FileReader();

      var f = files[0];
      reader.onload = function(e) {
        document.location.hash = '';
        document.getElementById('slider').value = 15;
        rescale();
        document.body.style.backgroundSize = 'auto';
        document.body.style.backgroundImage = 'url(' + e.target.result + ')';
        document.getElementById('image').src = e.target.result;
      };

      reader.readAsDataURL(f);
    }

    function handleDragOver(evt) {
      evt.stopPropagation();
      evt.preventDefault();
      evt.dataTransfer.dropEffect = 'link';
    }

    function onImageLoad() {
        try {
          document.getElementById('help').remove();
        } catch (err) {
          // ignore already removed help
        }
        var slider = document.getElementById('slider');
        slider.disabled = false;
        slider.focus();
    }

    function onHashChange() {
      if (document.location.hash.slice(1)) {
        var hashImage = document.location.hash.slice(1);
        document.body.style.backgroundImage = 'url(' + hashImage + ')';
        document.getElementById('image').src = hashImage;
      }
    }

    function onPageLoad() {
      var dropZone = document.getElementsByTagName('html')[0];
      dropZone.addEventListener('dragover', handleDragOver, false);
      dropZone.addEventListener('drop', handleFileSelect, false);

      document.getElementById('image').addEventListener('load', onImageLoad);
      document.getElementById('slider').addEventListener('change', rescale);

      window.addEventListener('hashchange', onHashChange, false);
      onHashChange();
    }
  </script>
</head>
<body onload="onPageLoad()">
  <center>
    <div id="help">
      <span>Drop any image here to try it as a background.</span>
    </div>
    <div>
      <span>
        <input type="range" min="0" max="15" value="15" step="0.25" id="slider" disabled>
      </span>
    </div>
    <div>
      <span id="percentage">100% &bull; <sup>1</sup>/<sub>1</sub></span>
    </div>
    <img id="image"/>
  </center>
</body>